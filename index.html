<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Controle Funer√°rio - Niter√≥i</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* ================================================================= */
        /* OVERRIDES DE PADRONIZA√á√ÉO DE DESIGN (Baseado no Processos Maru√≠) */
        /* ================================================================= */

        input[type="text"], input[type="date"], input[type="time"], input[type="datetime-local"], 
        input[type="email"], input[type="password"], input[type="month"], select, textarea {
            background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 8px 12px;
            font-family: 'Poppins', sans-serif; color: #334155; font-size: 13px; width: 100%; box-sizing: border-box;
            transition: all 0.2s ease; box-shadow: none; min-height: 38px; line-height: normal;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #3b82f6; background-color: #ffffff; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        input:disabled, select:disabled { background-color: #f1f5f9; color: #94a3b8; cursor: not-allowed; border-color: #e2e8f0; }

        label { font-size: 11px; text-transform: uppercase; font-weight: 700; color: #475569; margin-bottom: 6px; display: block; letter-spacing: 0.3px; }

        canvas#signature-pad { border: 2px dashed #cbd5e1; background-color: #f8fafc; touch-action: none; border-radius: 6px; cursor: crosshair; width: 100%; }

        .modal-footer-custom { display: flex; justify-content: center; align-items: center; padding-top: 20px; border-top: 1px solid #e2e8f0; flex-wrap: wrap; gap: 10px; }
        .modal-footer-custom button { padding: 9px 14px; font-size: 13px; border-radius: 6px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; font-weight: 600; transition: opacity 0.2s, transform 0.1s; }
        .modal-footer-custom button:hover { opacity: 0.9; }
        .modal-footer-custom button:active { transform: scale(0.98); }

        .btn-print { background-color: #ffffff !important; color: #475569 !important; border: 1px solid #cbd5e1 !important; }
        .btn-tag { background-color: #f59e0b !important; color: white !important; }
        .btn-sign-fam, .btn-sign-func { background-color: #7c3aed !important; color: white !important; }
        .btn-wpp { background-color: #22c55e !important; color: white !important; }
        .btn-sms { background-color: #3ba8ea !important; color: white !important; }
        .btn-transfer { background-color: #0ea5e9 !important; color: white !important; }
        .btn-close { background-color: #f1f5f9 !important; color: #475569 !important; box-shadow: none !important; }

        .tab-header { display: flex; flex-wrap: wrap; border-bottom: 1px solid #e2e8f0; margin-bottom: 20px; gap: 2px; overflow: visible; background-color: #f8fafc; border-radius: 8px 8px 0 0; }
        .tab-btn { background: transparent !important; border: none !important; color: #64748b !important; padding: 12px 15px !important; font-weight: 600 !important; font-size: 13px; cursor: pointer; border-bottom: 3px solid transparent !important; border-radius: 0 !important; transition: all 0.2s ease; white-space: nowrap; display: flex; align-items: center; gap: 8px; }
        .tab-btn:hover { color: #3b82f6 !important; background-color: #f1f5f9 !important; }
        .tab-btn.active { color: #3b82f6 !important; border-bottom: 3px solid #3b82f6 !important; background-color: #eff6ff !important; }

        #box-novo-usuario, #div-editar-usuario, #div-editar-contribuinte { background: #ffffff !important; border: 1px solid #e2e8f0 !important; border-radius: 8px; padding: 20px !important; box-shadow: 0 1px 3px rgba(0,0,0,0.02); margin-bottom: 25px; }
        .admin-form-title { color: #3b82f6; font-size: 16px; margin-bottom: 15px; display: block; font-weight: 700; }
        #box-novo-usuario label, #div-editar-usuario label, #div-editar-contribuinte label { color: #3b82f6 !important; }
        .btn-novo-usuario { background-color: #3b82f6; color: white; border: none; padding: 12px; border-radius: 6px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 5px; font-size: 14px; transition: background 0.2s; }
        .btn-novo-usuario:hover { background-color: #2563eb; }

        .box-membros-custom { border: 1px dashed #cbd5e1 !important; padding: 15px !important; border-radius: 8px !important; background: #ffffff !important; display: flex; flex-direction: column; gap: 10px; }
        .box-membros-custom .titulo-membros { color: #c2410c !important; font-size: 13px !important; margin-bottom: 5px; }

        .form-section-title { color: #1e293b; margin: 0; font-size: 14px; padding-bottom: 5px; }
        .form-section-divider { margin-top: 15px; margin-bottom: 10px; border-bottom: 2px solid #e2e8f0; padding-bottom: 5px; display: flex; align-items: center; gap: 8px; }

        .table-equipe-container { background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.02); margin-top: 15px; }
        .table-equipe-header { display: flex; padding: 15px 20px; border-bottom: 2px solid #f8fafc; color: #475569; font-size: 13px; font-weight: 700; }
        .table-equipe-row { display: flex; align-items: center; padding: 15px 20px; border-bottom: 1px solid #f1f5f9; transition: background 0.2s; }
        .table-equipe-row:last-child { border-bottom: none; }
        .table-equipe-row:hover { background-color: #f8fafc; }
        .avatar-circle { width: 42px; height: 42px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0; }
        .btn-action-edit { background: #ffedd5; color: #ea580c; border: none; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: opacity 0.2s; }
        .btn-action-delete { background: #fee2e2; color: #ef4444; border: none; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: opacity 0.2s; }
        .btn-action-edit:hover, .btn-action-delete:hover { opacity: 0.8; }
        
        .col-user { flex: 2; display: flex; align-items: center; gap: 15px; min-width: 250px; }
        .col-login { flex: 1.5; color: #475569; font-size: 13px; }
        .col-pass { flex: 1; color: #475569; font-size: 13px; display: flex; align-items: center; gap: 10px; }
        .col-actions { width: 100px; display: flex; gap: 8px; justify-content: flex-end; }

        .btn-nav-dashboard { background: none; border: none; font-family: 'Poppins', sans-serif; font-size: 14px; font-weight: 600; color: #64748b; cursor: pointer; padding: 5px 10px; border-radius: 6px; transition: 0.2s; }
        .btn-nav-dashboard:hover { background: #e2e8f0; color: #1e293b; }
        .btn-nav-dashboard.active { background: #3b82f6; color: #fff; }

        .badge-status { padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .badge-pendente { background-color: #fef08a; color: #854d0e; border: 1px solid #fde047; }
        .badge-sucesso { background-color: #bbf7d0; color: #166534; border: 1px solid #86efac; }
        
        .doc-chip { font-size: 9px; background: #e2e8f0; padding: 2px 5px; border-radius: 3px; color: #334155; font-weight: bold; margin-right: 3px; display: inline-block; margin-bottom: 3px; }
        .doc-chip.tem { background: #3b82f6; color: white; }

        @media (max-width: 768px) {
            .modal-footer-custom { padding-bottom: 20px; }
            .modal-footer-custom button { flex: 1 1 45%; max-width: 100%; }
            .table-equipe-header { display: none; }
            .table-equipe-row { flex-direction: column; align-items: flex-start; gap: 10px; position: relative; }
            .col-actions { position: absolute; top: 15px; right: 15px; }
            .tab-header { padding-bottom: 5px; }
        }
    </style>
</head>
<body>

    <div id="tela-bloqueio" class="bloqueio-container">
        <div class="bloqueio-box">
            <img src="https://niteroi.rj.gov.br/wp-content/uploads/2025/06/pmnlogo-2.png" alt="Logo">
            <h3>Controle de Acesso</h3>
            <p>Identifique-se para continuar</p>
            <input type="text" id="login-usuario" placeholder="Usu√°rio" style="margin-bottom: 10px;">
            <input type="password" id="login-senha" placeholder="Senha" onkeypress="checarLoginEnter(event)">
            <button onclick="fazerLogin()" class="btn-novo" style="width:100%; justify-content: center; margin-top: 15px; background-color: #3b82f6;">üîì Entrar</button>
            <p id="msg-erro-login" style="color: red; display: none; margin-top: 10px; font-weight:bold;">Dados incorretos!</p>
        </div>
    </div>

    <header class="header-prefeitura">
        <div class="logo-area">
            <img src="https://niteroi.rj.gov.br/wp-content/uploads/2025/06/pmnlogo-2.png" alt="Prefeitura de Niter√≥i" id="logo-principal">
            <div class="titulo-area">
                <div style="display: flex; gap: 10px; margin-left: 15px; border-left: 2px solid #999; padding-left: 15px; align-items: center;">
                    <button id="nav-btn-acolhimento" class="btn-nav-dashboard active" onclick="alternarDashboard('acolhimento')">üè† Acolhimento</button>
                    <button id="nav-btn-agencia" class="btn-nav-dashboard" onclick="alternarDashboard('agencia')">üè¢ Ag√™ncia</button>
                </div>
            </div>
        </div>
        
        <div class="info-area">
            <div class="controles-topo">
                <div class="topo-box"><span class="topo-icon">üìç</span><div class="topo-content"><label>Cemit√©rio</label><select id="filtro-local"><option value="CEMIT√âRIO DO MARU√ç">MARU√ç</option><option value="CEMIT√âRIO DE S√ÉO FRANCISCO">S√ÉO FRANCISCO</option><option value="CEMIT√âRIO DE ITAIPU">ITAIPU</option></select></div></div>
                <div class="topo-box"><span class="topo-icon">üìÖ</span><div class="topo-content"><label>Data</label><input type="date" id="filtro-data"></div></div>
                <div class="topo-box search-box"><input type="text" id="input-busca" placeholder="Buscar Nome ou Protocolo..."><button onclick="realizarBusca()" class="btn-search" title="Pesquisar">üîç</button></div>
            </div>
            <div class="user-controls">
                <span id="user-display"></span>
                <button onclick="abrirAdmin()" class="btn-header btn-admin" title="Painel Administrativo">‚öôÔ∏è Admin</button>
                <button onclick="alternarDesign()" class="btn-header btn-theme" title="Mudar Visual">üé® Tema</button>
                <button onclick="fazerLogout()" class="btn-header btn-exit" title="Sair">üö™ Sair</button>
            </div>
        </div>
    </header>

    <div id="dashboard-acolhimento" class="main-content">
        <div class="controles">
            <button onclick="imprimirRelatorio('portrait')" class="btn-imprimir">üñ®Ô∏è Retrato</button>
            <button onclick="imprimirRelatorio('landscape')" class="btn-imprimir">üñ®Ô∏è Paisagem</button>
            <button onclick="abrirModal()" class="btn-novo" style="background-color: #3b82f6;">+ Novo Atendimento</button>
        </div>

        <div class="tabela-container">
            <table>
                <thead>
                    <tr>
                        <th style="min-width: 250px;">Respons√°vel / Urna</th>
                        <th>Hora</th>
                        <th style="min-width: 220px;">Nome / Causa</th>
                        <th>Gav</th>
                        <th>Car</th>
                        <th>Sepul</th>
                        <th>QD</th>
                        <th>Hospital</th>
                        <th>Cap</th>
                        <th>Falecimento</th>
                        <th style="text-align: right; min-width: 120px;">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tabela-corpo-acolhimento"></tbody>
            </table>
        </div>
    </div>

    <div id="dashboard-agencia" class="main-content hidden">
        <div class="controles" style="justify-content: space-between;">
            <h3 style="color: #1e293b; margin: 0;">Gest√£o Documental e Processos (Ag√™ncia)</h3>
            <div>
                <button onclick="imprimirRelatorio('landscape')" class="btn-imprimir">üñ®Ô∏è Imprimir Rela√ß√£o</button>
            </div>
        </div>

        <div class="tabela-container">
            <table>
                <thead>
                    <tr>
                        <th>Falecido(a)</th>
                        <th>Respons√°vel / Empresa</th>
                        <th>Registro E-CIGA</th>
                        <th>Status GRM</th>
                        <th style="min-width: 180px;">Anexos ao Processo</th>
                        <th>Libera√ß√£o</th>
                        <th style="text-align: right; min-width: 100px;">Gest√£o</th>
                    </tr>
                </thead>
                <tbody id="tabela-corpo-agencia"></tbody>
            </table>
        </div>
    </div>

    <div id="modal-agencia" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Tr√¢mites da Ag√™ncia Funer√°ria</h3>
                <span class="close" onclick="fecharModalAgencia()">√ó</span>
            </div>
            
            <form id="form-agencia">
                <input type="hidden" id="agencia_docId"> 
                
                <div class="form-grid">
                    <div class="input-group span-4" style="background: #f1f5f9; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <span style="font-size: 11px; font-weight:bold; color:#64748b;">FALECIDO(A):</span>
                        <div id="agencia_nome_falecido" style="font-weight: 800; color: #1e293b; font-size: 16px;"></div>
                    </div>

                    <div class="input-group span-4 form-section-divider">
                        <h4 class="form-section-title">Abertura de Processos</h4>
                    </div>

                    <div class="input-group span-2">
                        <label>N¬∫ Processo E-CIGA</label>
                        <input type="text" id="agencia_processo" placeholder="000/000000/2026">
                    </div>
                    <div class="input-group span-2">
                        <label>Status GRM</label>
                        <select id="agencia_grm">
                            <option value="PENDENTE">Pendente</option>
                            <option value="GERADA">Gerada</option>
                            <option value="ENTREGUE">Entregue (Fam√≠lia/Funer√°ria)</option>
                            <option value="ISENTO">Isento (Gratuidade)</option>
                        </select>
                    </div>

                    <div class="input-group span-4 form-section-divider">
                        <h4 class="form-section-title">Anexos F√≠sicos/Digitais</h4>
                    </div>

                    <div class="input-group span-4" style="display: flex; gap: 15px; flex-wrap: wrap; background: #fff; border: 1px dashed #cbd5e1; padding: 15px; border-radius: 8px;">
                        <label style="display:flex; align-items:center; gap:5px; margin:0; cursor:pointer; font-weight:600; color:#334155; text-transform:none;"><input type="checkbox" id="agencia_chk_invol" style="width:auto; margin:0;"> Guia INVOL</label>
                        <label style="display:flex; align-items:center; gap:5px; margin:0; cursor:pointer; font-weight:600; color:#334155; text-transform:none;"><input type="checkbox" id="agencia_chk_nf" style="width:auto; margin:0;"> Nota Fiscal</label>
                        <label style="display:flex; align-items:center; gap:5px; margin:0; cursor:pointer; font-weight:600; color:#334155; text-transform:none;"><input type="checkbox" id="agencia_chk_tanato" style="width:auto; margin:0;"> Cert. Tanato</label>
                        <label style="display:flex; align-items:center; gap:5px; margin:0; cursor:pointer; font-weight:600; color:#334155; text-transform:none;"><input type="checkbox" id="agencia_chk_comprovante" style="width:auto; margin:0;"> Comp. Pagamento</label>
                    </div>

                    <div class="input-group span-4 form-section-divider">
                        <h4 class="form-section-title">Finaliza√ß√£o</h4>
                    </div>

                    <div class="input-group span-4">
                        <label>Status da Libera√ß√£o p/ Cemit√©rio</label>
                        <select id="agencia_status_liberacao" style="font-weight: bold;">
                            <option value="PENDENTE">AGUARDANDO TR√ÇMITES</option>
                            <option value="LIBERADO">LIBERADO PARA SEPULTAMENTO</option>
                        </select>
                    </div>
                </div>

                <div class="modal-footer-custom" style="justify-content: space-between;">
                    <button type="button" class="btn-close" style="width: auto;" onclick="fecharModalAgencia()">Cancelar</button>
                    <button type="button" class="btn-novo" style="width: auto; background-color: #10b981;" onclick="salvarDadosAgencia()">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>


    <div id="modal" class="modal">
        <div class="modal-content" style="max-width: 850px;">
            <div class="modal-header">
                <h3>Registro de Atendimento</h3>
                <span class="close" onclick="fecharModal()">√ó</span>
            </div>
            
            <form id="form-atendimento">
                <input type="hidden" id="docId"> 
                <input type="hidden" id="protocolo_hidden">
                
                <div class="form-grid">
                    <div class="input-group span-4 hidden" id="div-motivo-edicao" style="background: #fff3cd; padding: 10px; border-radius: 5px; border: 1px solid #ffeeba; margin-bottom: 10px;">
                        <label style="color:#856404; font-weight:bold;">‚ö†Ô∏è Motivo da Corre√ß√£o (Obrigat√≥rio)</label>
                        <input type="text" id="motivo_edicao" placeholder="Justifique a altera√ß√£o..." style="border: 1px solid #e0a800; background-color: #fff;">
                    </div>

                    <div class="input-group span-2">
                        <label>Data/Hora Atendimento (Registro)</label>
                        <input type="datetime-local" id="data_hora_atendimento" required>
                    </div>

                    <div class="input-group span-1">
                        <label>Data Sepultamento</label>
                        <input type="date" id="data_ficha_modal" required>
                    </div>

                    <div class="input-group span-1"><label>Hora Sepultamento</label><select id="hora" required></select></div>
                    
                    <div class="input-group span-2"><label style="color:#3b82f6;">Atendente Respons√°vel</label><input type="text" id="atendente_sistema" readonly></div>
                    
                    <div class="input-group span-4" style="background-color: #f1f5f9; border: 1px dashed #cbd5e1; padding: 8px 12px; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="chk_indigente" style="width: auto; height: 16px; width: 16px; margin:0;">
                        <label for="chk_indigente" style="margin: 0; color: #475569; cursor: pointer; text-transform: none; font-size:13px;">Sepultamento de Indigente (Desativa campos obrigat√≥rios)</label>
                    </div>

                    <div class="input-group span-4 form-section-divider">
                        <span style="font-size:16px;">üìù</span><h4 class="form-section-title">Dados do Respons√°vel (Contribuinte)</h4>
                    </div>

                    <div class="input-group span-1">
                        <label>CPF</label>
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="resp_cpf" placeholder="000.000.000-00" required>
                            <button type="button" onclick="buscarPorCPF()" class="btn-novo" style="width:40px; padding:0; justify-content:center; border-radius:6px; background-color: #3b82f6;" title="Buscar Contribuinte">üîç</button>
                        </div>
                    </div>
                    
                    <div class="input-group span-1"><label>RG</label><input type="text" id="resp_rg"></div>
                    <div class="input-group span-2"><label>Nome do Respons√°vel / Empresa</label><input type="text" id="resp_nome" placeholder="Nome completo" required></div>
                    
                    <div class="input-group span-1"><label>CEP</label><input type="text" id="resp_cep" placeholder="00000-000" onblur="buscarCEP(this.value)"></div>
                    <div class="input-group span-2"><label>Endere√ßo (Rua, Avenida)</label><input type="text" id="resp_endereco"></div>
                    <div class="input-group span-1"><label>N√∫mero</label><input type="text" id="resp_numero"></div>
                    
                    <div class="input-group span-1"><label>Complemento</label><input type="text" id="resp_complemento" placeholder="Apt, Bloco"></div>
                    <div class="input-group span-1"><label>Bairro</label><input type="text" id="resp_bairro"></div>
                    <div class="input-group span-1"><label>Cidade</label><input type="text" id="resp_cidade"></div>
                    <div class="input-group span-1"><label>UF</label><input type="text" id="resp_uf" placeholder="Ex: RJ"></div>
                    
                    <div class="input-group span-2"><label>Telefone Respons√°vel</label><input type="text" id="telefone" placeholder="(21) 99999-9999" required></div>
                    <div class="input-group span-2"><label>Grau Parentesco</label><input type="text" id="parentesco" list="lista-parentesco" placeholder="Selecione..."><datalist id="lista-parentesco"><option value="C√îNJUGE"><option value="FILHO(A)"><option value="PAI/M√ÉE"><option value="IRM√ÉO(√É)"><option value="NETO(A)"><option value="SOBRINHO(A)"><option value="GENRO/NORA"><option value="CUNHADO(A)"><option value="TIO(A)"><option value="PRIMO(A)"><option value="OUTRO"></datalist></div>
                    
                    <div class="input-group span-4 form-section-divider">
                        <span style="font-size:16px;">‚ö∞Ô∏è</span><h4 class="form-section-title">Dados do Falecido e Estrutura</h4>
                    </div>

                    <div class="input-group span-2"><label>Estado Civil (Falecido)</label><select id="estado_civil"><option value="">Selecione...</option><option value="SOLTEIRO">SOLTEIRO</option><option value="CASADO">CASADO</option><option value="VIUVO">VI√öVO</option><option value="UNIAO_ESTAVEL">UNI√ÉO EST√ÅVEL</option><option value="DIVORCIADO">DIVORCIADO</option><option value="IGNORADO">IGNORADO</option></select></div>

                    <div class="input-group span-2"><label>Funer√°ria</label><input type="text" id="funeraria" list="lista-funerarias" placeholder="Selecione..." required><datalist id="lista-funerarias"><option value="RIO PAX NITER√ìI"><option value="FUNER√ÅRIA SANTA ROSA"><option value="FUNER√ÅRIA NITER√ìI"><option value="FUNER√ÅRIA S√ÉO FRANCISCO"><option value="FUNER√ÅRIA MENINO DEUS"><option value="SAF (ASSIST√äNCIA FAMILIAR)"><option value="PLASIR"><option value="SOCIAL"><option value="DOM BOSCO"><option value="MAVERICK"><option value="PR√ìPRIA FAM√çLIA"></datalist></div>

                    <div class="input-group span-2"><label>Rep. Funer√°ria (Se houver)</label><input type="text" id="func_funeraria" placeholder="Nome do funcion√°rio da funer√°ria"></div>

                    <div class="input-group span-1"><label>Isen√ß√£o?</label><select id="isencao" required><option value="NAO">N√ÉO (PAGO)</option><option value="SIM">SIM (100% GRATUIDADE)</option><option value="50">SIM (50% DESCONTO)</option></select></div>
                    <div class="input-group span-1"><label>Requisito Isen√ß√£o</label><input type="text" id="requisito" list="lista-requisitos" placeholder="Motivo..."><datalist id="lista-requisitos"><option value="CADUNICO"><option value="MOEDA ARARIBOIA"><option value="FUNCION√ÅRIO PMN"><option value="OUTRO (DIGITE)"></datalist></div>
                    
                    <div class="input-group span-1"><label>Classifica√ß√£o</label><select id="classificacao_obito"><option value="ADULTO">ADULTO</option><option value="ANJO">ANJO (Crian√ßa/Natimorto)</option></select></div>
                    
                    <div class="input-group span-3 box-membros-custom">
                        <label class="titulo-membros">Situa√ß√£o: Membros</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div style="display:flex; align-items:center; gap:8px;">
                                <input type="checkbox" id="chk_membro" style="width:auto; height: 16px; width: 16px; margin:0;">
                                <label for="chk_membro" style="margin:0; cursor:pointer; color:#334155; text-transform:none;">Sepultamento de Membro</label>
                            </div>
                            <select id="tipo_membro_select" disabled style="flex:1;">
                                <option value="">Selecione o membro...</option>
                                <option value="MEMBRO SUPERIOR DIREITO">MEMBRO SUPERIOR DIREITO</option>
                                <option value="MEMBRO SUPERIOR ESQUERDO">MEMBRO SUPERIOR ESQUERDO</option>
                                <option value="MEMBRO INFERIOR DIREITO">MEMBRO INFERIOR DIREITO</option>
                                <option value="MEMBRO INFERIOR ESQUERDO">MEMBRO INFERIOR ESQUERDO</option>
                                <option value="OUTROS">OUTROS</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-group span-1"><label>Tamanho Urna</label><select id="combo_urna"><option value="">Selecione...</option><option value="NORMAL">Normal</option><option value="G">G</option><option value="GG">GG</option><option value="3G">3G</option></select></div>
                    <div class="input-group span-2"><label>Tipo da Urna (Material/Modelo)</label><input type="text" id="tipo_urna_detalhe" list="lista-tipos-urna" placeholder="Ex: Madeira, Sextavada..."><datalist id="lista-tipos-urna"><option value="MADEIRA PADR√ÉO"><option value="SEXTAVADA"><option value="ZINCO"><option value="BIO (ECOL√ìGICA)"><option value="LUXO"><option value="IML / RABEC√ÉO"></datalist></div>
                    <div class="input-group span-2"><label>Servi√ßos Adicionais</label><div class="checkbox-group"><label><input type="checkbox" id="chk_tanato"> Tanatopraxia</label><label><input type="checkbox" id="chk_invol"> Invol</label><label><input type="checkbox" id="chk_translado"> Translado</label><label><input type="checkbox" id="chk_urna_opc"> Urna</label></div></div>
                    <div class="input-group span-4"><label>Nome do Falecido</label><input type="text" id="nome" required style="font-weight: 600;"></div>
                    <div class="input-group span-4"><label>Causa da Morte</label><div style="display: flex; gap: 10px;"><select id="seletor_causas" style="width: 40%; border: 1px solid #3699ff;"><option value="">+ Adicionar Causa...</option><optgroup label="Doen√ßas Infecciosas / Risco"><option value="COVID-19">COVID-19</option><option value="TUBERCULOSE">TUBERCULOSE</option><option value="MENINGITE">MENINGITE</option><option value="HEPATITE B">HEPATITE B</option><option value="HEPATITE C">HEPATITE C</option><option value="HIV/AIDS">HIV/AIDS</option><option value="H1N1 (INFLUENZA)">H1N1 (INFLUENZA)</option><option value="LEPTOSPIROSE">LEPTOSPIROSE</option><option value="SARAMPO">SARAMPO</option><option value="FEBRE AMARELA">FEBRE AMARELA</option><option value="SEPSE / SEPTICEMIA">SEPSE / SEPTICEMIA</option></optgroup><optgroup label="Causas Comuns"><option value="CHOQUE S√âPTICO">CHOQUE S√âPTICO</option><option value="INSUFICI√äNCIA RESPIRAT√ìRIA">INSUFICI√äNCIA RESPIRAT√ìRIA</option><option value="INSUFICI√äNCIA RENAL AGUDA">INSUFICI√äNCIA RENAL AGUDA</option><option value="NEOPLASIA MALIGNA">NEOPLASIA MALIGNA</option><option value="INFARTO AGUDO DO MIOC√ÅRDIO">INFARTO (IAM)</option><option value="AVC">AVC (ACIDENTE VASCULAR)</option><option value="PNEUMONIA">PNEUMONIA</option><option value="FAL√äNCIA M√öLTIPLA DE √ìRG√ÉOS">FAL√äNCIA M√öLTIPLA</option><option value="SENILIDADE">SENILIDADE</option><option value="HIPERTENS√ÉO ARTERIAL">HIPERTENS√ÉO ARTERIAL</option><option value="DIABETES MELLITUS">DIABETES MELLITUS</option><option value="PARADA CARDIORRESPIRAT√ìRIA">PARADA CARDIORRESPIRAT√ìRIA</option><option value="CIRROSE HEP√ÅTICA">CIRROSE HEP√ÅTICA</option><option value="DOEN√áA DE ALZHEIMER">DOEN√áA DE ALZHEIMER</option></optgroup><optgroup label="Causas Externas"><option value="TRAUMATISMO CRANIANO">TRAUMATISMO CRANIANO</option><option value="AFOGAMENTO">AFOGAMENTO</option><option value="ACIDENTE DE TR√ÇNSITO">ACIDENTE DE TR√ÇNSITO</option><option value="HOMIC√çDIO (PAF)">HOMIC√çDIO (PAF)</option><option value="SUIC√çDIO">SUIC√çDIO</option><option value="CAUSA INDETERMINADA">CAUSA INDETERMINADA</option></optgroup></select><input type="text" id="causa" placeholder="Causas aparecer√£o aqui..." required style="width: 60%;"></div></div>
                    
                    <div class="input-group span-1">
                        <label>Tipo Sepultura</label>
                        <select id="tipo_sepultura" required>
                            <option value="">Selecione...</option>
                            <option value="GAVETA">Gaveta</option>
                            <option value="CARNEIRO">Carneiro</option>
                            <option value="PERPETUA">Perp√©tua</option>
                            <option value="COVA RASA">Cova Rasa</option>
                            <option value="GAVETA_ANJO">Gaveta Anjo</option>
                            <option value="CARNEIRO_ANJO">Carneiro Anjo</option>
                            <option value="COVA_RASA_ANJO">Cova Rasa Anjo</option>
                            <option value="MEMBRO">Membro Amputado</option>
                            <option value="GAVETA PERPETUA">Gaveta Perp√©tua</option>
                            <option value="CARNEIRO PERPETUO">Carneiro Perp√©tuo</option>
                            <option value="COVA RASA PERPETUA">Cova Rasa Perp√©tua</option>
                            <option value="GAVETA ANJO PERPETUA">Gaveta Anjo Perp√©tua</option>
                            <option value="CARNEIRO ANJO PERPETUO">Carneiro Anjo Perp√©tuo</option>
                            <option value="COVA RASA ANJO PERPETUA">Cova Rasa Anjo Perp√©tua</option>
                        </select>
                    </div>
                    
                    <div class="input-group span-2 hidden" id="div-perpetua" style="flex-direction: row; gap: 10px;">
                         <div style="flex:1;"><label>Livro</label><input type="text" id="livro_perpetua" placeholder="N¬∫ Livro"></div>
                         <div style="flex:1;"><label>Folha</label><input type="text" id="folha_perpetua" placeholder="N¬∫ Folha"></div>
                    </div>

                    <div class="input-group span-2 hidden" id="div-membro"><input type="hidden" id="membro_amputado"></div>

                    <div class="input-group span-1"><label>N¬∫ Sepul</label><input type="text" id="sepul" required></div>
                    <div class="input-group span-1"><label>QD</label><input type="text" id="qd" required></div>
                    <div class="input-group span-1"><label>GPS</label><div style="display:flex; gap:5px;"><input type="text" id="geo_coords" placeholder="-22..., -43..." title="Copie do Google Maps"><button type="button" onclick="pegarLocalizacaoGPS()" class="btn-novo" style="width:40px; padding:0; justify-content:center; border-radius:6px;">üìç</button><button type="button" onclick="window.open('https://maps.google.com/')" class="btn-imprimir" style="width:40px; padding:0; justify-content:center; border-radius:6px;">üó∫Ô∏è</button></div></div>
                    <div class="input-group span-4 hidden" id="div-motivo-sepultura"><label style="color:red;">Motivo Troca</label><input type="text" id="motivo_troca_sepultura" placeholder="Explique a mudan√ßa..."></div>
                    <div class="input-group span-2"><label>Hospital / Local</label><input type="text" id="hospital" list="lista-hospitais" placeholder="Selecione..." required><datalist id="lista-hospitais"><option value="DOMIC√çLIO"><option value="OUTRO HOSPITAL (DIGITE O NOME)"><option value="HMCT (CARLOS TORTELLY)"><option value="HEAL (AZEVEDO LIMA)"><option value="HUAP (ANT√îNIO PEDRO)"><option value="HOSP. OR√äNCIO DE FREITAS)"><option value="HOSP. PSIQUI√ÅTRICO JURUJUBA)"><option value="HOSP. OCE√ÇNICO)"><option value="HOSP. GETULINHO)"><option value="UPA M√ÅRIO MONTEIRO)"><option value="UPA FONSECA)"><option value="CHN (COMPLEXO HOSPITALAR)"><option value="HCN (CL√çNICAS DE NITER√ìI)"><option value="HOSP. SANTA MARTHA)"><option value="HOSP. S√ÉO LUCAS)"><option value="HOSP. ICARA√ç)"><option value="HEAT (ALBERTO TORRES)"><option value="HOSP. LUIZ PALMIER)"><option value="PRONTO SOCORRO CENTRAL (SG)"><option value="HOSP. S√ÉO GON√áALO)"><option value="HOSP. FRANCISCANO (NS. GRA√áAS)"><option value="IML - NITER√ìI)"><option value="IML - S√ÉO GON√áALO)"></datalist></div>
                    <div class="input-group span-2 hidden" id="div-local-domicilio" style="flex-direction: row; gap: 5px;"><div style="flex: 1;"><label>UF</label><select id="estado_obito"><option value="">UF</option><option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option><option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option><option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option><option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option><option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option><option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option><option value="RJ">RJ</option><option value="RN">RN</option><option value="RS">RS</option><option value="RO">RO</option><option value="RR">RR</option><option value="SC">SC</option><option value="SP">SP</option><option value="SE">SE</option><option value="TO">TO</option></select></div><div style="flex: 2;"><label>Cidade</label><select id="cidade_obito" disabled><option value="">Selecione a UF</option></select></div></div>
                    <div class="input-group span-2"><label>Capela</label><input type="text" id="cap" list="lista-capelas" placeholder="Selecione..." required><datalist id="lista-capelas"><option value="SEM VEL√ìRIO / DIRETO"><option value="CAPELA A"><option value="CAPELA B"><option value="CAPELA C"><option value="CAPELA D"><option value="CAPELA E"><option value="CAPELA F"><option value="CAPELA G"><option value="CAPELA H"></datalist></div>
                    <div class="input-group span-2"><label>Data Falecimento</label><input type="date" id="data_obito" required></div>
                    
                    <div class="input-group span-2">
                        <label>Hora Falecimento</label>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <input type="time" id="hora_obito">
                            <label style="display:flex; align-items:center; gap:5px; margin:0; cursor:pointer;">
                                <input type="checkbox" id="chk_ignorar_hora" style="width:auto; margin:0;"> <span style="font-size:10px; color:#475569;">IGNORAR</span>
                            </label>
                        </div>
                    </div>

                    <div class="input-group span-1"><label>Sepult. < 24h?</label><select id="do_24h"><option value="NAO">N√ÉO</option><option value="SIM">SIM (Liberado)</option></select></div>
                    <div class="input-group span-3"><label>Observa√ß√µes</label><textarea id="urna_info" rows="2" placeholder="Observa√ß√µes gerais..."></textarea></div>
                </div>
                <div class="modal-footer-custom" style="justify-content: space-between;">
                    <button type="button" class="btn-close" style="width: auto;" onclick="fecharModal()">Cancelar</button>
                    <button type="submit" class="btn-novo" style="width: auto; background-color: #3b82f6;">Salvar Dados</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-visualizar" class="modal">
        <div class="modal-content" style="max-width: 700px; background: #fff;">
            <div class="modal-header">
                <h3>Ficha de Atendimento</h3>
                <span class="close" onclick="fecharModalVisualizar()">√ó</span>
            </div>
            <div class="ficha-visualizacao">
                <div class="ficha-header"><h2>Prefeitura Municipal de Niter√≥i</h2><p>Coordenadoria Municipal de Servi√ßos Funer√°rios</p></div>
                <div class="ficha-linha"><span class="ficha-label">PROTOCOLO:</span><span class="ficha-valor" id="view_protocolo" style="font-family:'Courier New'; letter-spacing:1px; font-size:16px;"></span></div>
                <div class="ficha-linha"><span class="ficha-label">ATENDENTE:</span><span class="ficha-valor" id="view_atendente" style="color:#3b82f6; font-weight:bold;"></span></div>
                <div class="ficha-linha"><span class="ficha-label">DATA/HORA ATENDIMENTO:</span><span class="ficha-valor" id="view_data_registro" style="font-weight: bold;"></span></div>
                <div class="ficha-linha"><span class="ficha-label">HOR√ÅRIO SEPUL.:</span><span class="ficha-valor" id="view_hora"></span></div>
                <div class="ficha-linha"><span class="ficha-label">FALECIDO(A):</span><span class="ficha-valor" id="view_nome"></span></div>
                <div class="ficha-linha"><span class="ficha-label">CAUSA DA MORTE:</span><span class="ficha-valor" id="view_causa"></span></div>
                <div class="ficha-linha"><span class="ficha-label">RESPONS√ÅVEL:</span><span class="ficha-valor" id="view_resp_completo"></span></div>
                <div class="ficha-linha"><span class="ficha-label">CPF / RG:</span><span class="ficha-valor"><span id="view_resp_cpf"></span> / <span id="view_resp_rg"></span></span></div>
                <div class="ficha-linha"><span class="ficha-label">TELEFONE:</span><span class="ficha-valor" id="view_telefone"></span></div>
                <div class="ficha-linha"><span class="ficha-label">FUNER√ÅRIA:</span><span class="ficha-valor" id="view_funeraria"></span></div>
                <div class="ficha-linha"><span class="ficha-label">ACOLHIMENTO:</span><span class="ficha-valor" id="view_isencao_completa"></span></div>
                <div class="ficha-linha"><span class="ficha-label">DADOS DA URNA:</span><span class="ficha-valor"><span id="view_combo_urna"></span> - <span id="view_tipo_urna_detalhe"></span></span></div>
                <div class="ficha-linha"><span class="ficha-label">SERVI√áOS EXTRAS:</span><span class="ficha-valor" id="view_servicos_adicionais"></span></div>
                <div class="ficha-linha"><span class="ficha-label">LOCAL SEPUL.:</span><span class="ficha-valor" id="view_local_sepul"></span></div>
                <div class="ficha-linha"><span class="ficha-label">LOCAL √ìBITO:</span><span class="ficha-valor" id="view_hospital_completo"></span></div>
                <div class="ficha-linha"><span class="ficha-label">VEL√ìRIO:</span><span class="ficha-valor" id="view_cap"></span></div>
                <div class="ficha-linha"><span class="ficha-label">DATA/HORA √ìBITO:</span><span class="ficha-valor"><span id="view_data_obito"></span> √†s <span id="view_hora_obito"></span><span id="view_do_24h" style="margin-left:10px; color:var(--danger); font-weight:900;"></span></span></div>
                <div class="ficha-linha" style="border-bottom: none;"><span class="ficha-label">OBSERVA√á√ïES:</span><span class="ficha-valor" id="view_urna_info" style="display: block; margin-top: 5px;"></span></div>
                <div id="view_map_container" style="display:none; margin-top: 20px;"><div class="ficha-linha" style="border-bottom:none; margin-bottom:5px;"><span class="ficha-label">Localiza√ß√£o:</span></div><div id="mapa-frame" style="width:100%; height:250px; border:1px solid #e2e8f0; border-radius:6px; overflow:hidden;"></div><div style="text-align:right; margin-top:5px;"><a id="link-gps" href="#" target="_blank" style="font-size:12px; font-weight:bold; color:#3b82f6; text-decoration:none;">üìç Abrir no Google Maps</a></div></div>
            </div>
            
            <div class="modal-footer-custom">
                <button type="button" class="btn-print" onclick="gerarComprovante()">üìÑ Comprovante</button>
                <button type="button" class="btn-print" onclick="gerarAutorizacao()">üìù Autoriza√ß√£o</button>
                <button type="button" class="btn-tag" onclick="gerarEtiqueta()">üè∑Ô∏è Etiqueta</button>
                <button type="button" class="btn-sign-fam" onclick="abrirModalAssinatura('responsavel')">‚úçÔ∏è Assinar Fam√≠lia</button>
                <button type="button" class="btn-sign-func" onclick="abrirModalAssinatura('atendente')">‚úçÔ∏è Assinar Equipe</button>
                <button type="button" class="btn-wpp" onclick="abrirModalWpp()">üì± WhatsApp</button>
                <button type="button" class="btn-transfer" onclick="abrirModalTransferir()">üîÑ Transferir</button>
                <button type="button" class="btn-close" onclick="fecharModalVisualizar()">Fechar</button>
            </div>
        </div>
    </div>

    <div id="modal-admin" class="modal">
        <div class="modal-content" style="max-width: 900px; height: 85vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="border-bottom: 1px solid #e2e8f0;">
                <h3 style="color: #1e293b;">Painel Administrativo</h3>
                <span class="close" onclick="fecharModalAdmin()">√ó</span>
            </div>
            <div class="tab-header">
                <button class="tab-btn active" onclick="abrirAba('tab-equipe')">üë• Equipe</button>
                <button class="tab-btn" onclick="abrirAba('tab-contribuintes')">üìá Contribuintes</button>
                <button class="tab-btn" onclick="abrirAba('tab-backup')">üíæ Backup</button>
                <button class="tab-btn" onclick="abrirAba('tab-stats')">üìä Estat√≠sticas</button>
                <button class="tab-btn" onclick="abrirAba('tab-logs')">üïµÔ∏è Auditoria</button>
            </div>
            <div class="tab-content-area" style="flex-grow: 1; overflow-y: auto; padding: 20px;">
                
                <div id="tab-equipe" class="tab-pane active">
                    <div id="box-novo-usuario">
                        <span class="admin-form-title">Novo Usu√°rio:</span>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div><label>NOME COMPLETO</label><input type="text" id="novo-nome" placeholder="Ex: Jo√£o Silva"></div>
                            <div><label>LOGIN / WHATSAPP</label><input type="text" id="novo-login" placeholder="Ex: joao.silva"></div>
                            <div><label>E-MAIL</label><input type="email" id="novo-email" placeholder="Ex: joao@email.com"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                             <div><label>SENHA</label><input type="password" id="nova-senha" placeholder="Senha segura"></div>
                        </div>
                        <button onclick="adicionarFuncionario()" class="btn-novo-usuario">+ Adicionar Usu√°rio</button>
                    </div>

                    <div id="div-editar-usuario" class="hidden">
                        <span class="admin-form-title" style="color: #f59e0b;">‚úèÔ∏è Editando Usu√°rio:</span>
                        <input type="hidden" id="edit-id">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div><label>NOME COMPLETO</label><input type="text" id="edit-nome" placeholder="Nome e Sobrenome"></div>
                            <div><label>LOGIN</label><input type="text" id="edit-login" placeholder="Login" disabled></div>
                            <div><label>E-MAIL</label><input type="email" id="edit-email" placeholder="E-mail"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                             <div><label>NOVA SENHA</label><input type="text" id="edit-senha" placeholder="Nova Senha"></div>
                        </div>
                        <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:15px;">
                            <button onclick="cancelarEdicao()" class="btn-modal btn-close">Cancelar</button>
                            <button onclick="salvarEdicaoUsuario()" class="btn-modal btn-novo-usuario" style="width:auto; margin:0;">Salvar Altera√ß√µes</button>
                        </div>
                    </div>

                    <div class="table-equipe-container">
                        <div class="table-equipe-header">
                            <div class="col-user">Usu√°rio</div>
                            <div class="col-login">Login / Contato</div>
                            <div class="col-pass">Senha</div>
                            <div class="col-actions">A√ß√µes</div>
                        </div>
                        <ul id="lista-equipe" style="list-style: none; padding: 0; margin: 0;"></ul>
                    </div>
                </div>

                <div id="tab-contribuintes" class="tab-pane">
                    
                    <div id="box-busca-contribuinte" style="display:flex; justify-content: space-between; align-items:flex-end; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                        <h4 style="color: #334155; margin: 0;">Buscar Contribuintes</h4>
                        <div style="display: flex; gap: 10px; flex-grow: 1; max-width: 500px;">
                            <input type="text" id="input-busca-contribuinte" placeholder="Buscar Nome, CPF, RG ou Telefone" onkeypress="if(event.key === 'Enter') buscarContribuintes()">
                            <button onclick="buscarContribuintes()" class="btn-novo" style="background-color: #3b82f6; width: auto; padding: 0 20px;">üîç Buscar</button>
                        </div>
                    </div>

                    <div id="div-tabela-contribuintes" class="table-equipe-container">
                        <div class="table-equipe-header" style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                            <div style="flex: 2;">Nome</div>
                            <div style="flex: 1.5;">CPF / RG</div>
                            <div style="flex: 1.5;">Contato</div>
                            <div style="flex: 2;">Endere√ßo</div>
                            <div style="width: 60px; text-align: right;">A√ß√µes</div>
                        </div>
                        <ul id="lista-contribuintes" style="list-style: none; padding: 0; margin: 0;">
                            <li style="padding: 20px; text-align: center; color: #64748b; font-weight: 500;">Use a busca acima para encontrar contribuintes cadastrados.</li>
                        </ul>
                    </div>

                    <div id="div-editar-contribuinte" class="hidden">
                        <span class="admin-form-title" style="color: #f59e0b;">‚úèÔ∏è Editando Contribuinte:</span>
                        <input type="hidden" id="edit-contribuinte-cpf-original">
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div><label>NOME COMPLETO</label><input type="text" id="edit-contribuinte-nome"></div>
                            <div><label>CPF</label><input type="text" id="edit-contribuinte-cpf" disabled title="O CPF n√£o pode ser alterado por ser a chave do cadastro."></div>
                            <div><label>RG</label><input type="text" id="edit-contribuinte-rg"></div>
                            <div><label>TELEFONE</label><input type="text" id="edit-contribuinte-telefone"></div>
                            <div><label>CEP</label><input type="text" id="edit-contribuinte-cep" onblur="buscarCEPEdicao(this.value)"></div>
                            <div><label>ENDERE√áO</label><input type="text" id="edit-contribuinte-endereco"></div>
                            <div><label>N√öMERO</label><input type="text" id="edit-contribuinte-numero"></div>
                            <div><label>COMPLEMENTO</label><input type="text" id="edit-contribuinte-complemento"></div>
                            <div><label>BAIRRO</label><input type="text" id="edit-contribuinte-bairro"></div>
                            <div><label>CIDADE</label><input type="text" id="edit-contribuinte-cidade"></div>
                            <div><label>UF</label><input type="text" id="edit-contribuinte-uf"></div>
                        </div>
                        
                        <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:15px;">
                            <button onclick="cancelarEdicaoContribuinte()" class="btn-modal btn-close">Cancelar</button>
                            <button onclick="salvarEdicaoContribuinte()" class="btn-modal btn-novo-usuario" style="width:auto; margin:0;">Salvar Altera√ß√µes</button>
                        </div>
                    </div>
                </div>

                <div id="tab-stats" class="tab-pane">
                    <div class="controles-topo" style="margin-bottom: 20px; justify-content: center; gap: 10px; flex-wrap: wrap; align-items: center;">
                        <button onclick="carregarEstatisticas('7')" class="btn-close" style="padding: 8px 15px; border-radius: 6px;">7 Dias</button>
                        <button onclick="carregarEstatisticas('14')" class="btn-close" style="padding: 8px 15px; border-radius: 6px;">14 Dias</button>
                        <button onclick="carregarEstatisticas('30')" class="btn-close" style="padding: 8px 15px; border-radius: 6px;">30 Dias</button>
                        <button onclick="carregarEstatisticas('mes')" class="btn-close" style="padding: 8px 15px; border-radius: 6px;">Este M√™s</button>
                        <div style="width: 1px; height: 25px; background: #e2e8f0; margin: 0 10px;"></div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <input type="month" id="filtro-mes-ano" style="padding: 6px 10px; width: 150px;">
                            <button onclick="carregarEstatisticas('custom')" class="btn-novo" style="background-color: #64748b; padding: 8px 12px; height: 34px;" title="Filtrar">üîç</button>
                        </div>
                        <div style="width: 1px; height: 25px; background: #e2e8f0; margin: 0 10px;"></div>
                        <button onclick="baixarRelatorioCompleto()" class="btn-novo" style="background-color: #3b82f6; padding: 8px 15px; height: 34px;">üìä Relat√≥rio Geral</button>
                        <button onclick="baixarExcel()" class="btn-novo" style="background-color: #22c55e; padding: 8px 15px; height: 34px;">üì• Planilha Stats</button>
                    </div>
                    <div id="loading-stats" style="text-align:center; display:none; color:#64748b;">Carregando dados...</div>
                    <div style="display: flex; flex-direction: column; gap: 30px;">
                        <div class="grafico-container" style="height: 350px;"><h5 style="text-align:center; margin-bottom:10px; color:#334155;">Causas de Morte (Top 10)</h5><canvas id="grafico-causas"></canvas></div>
                        <div class="grafico-container" style="height: 350px;"><h5 style="text-align:center; margin-bottom:10px; color:#334155;">Atendimentos por Funcion√°rio</h5><canvas id="grafico-atendentes"></canvas></div>
                    </div>
                </div>

                <div id="tab-logs" class="tab-pane">
                    <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom: 15px;">
                        <h4 style="color: #334155;">Log de Auditoria e Altera√ß√µes</h4>
                        <div style="display:flex; gap: 10px;">
                            <button onclick="baixarLogsExcel()" class="btn-novo" style="background-color:#22c55e; padding: 6px 12px; font-size:12px; height:auto;">üì• Excel</button>
                            <button onclick="baixarLogsPDF()" class="btn-novo" style="background-color:#ef4444; padding: 6px 12px; font-size:12px; height:auto;">üìÑ PDF</button>
                            <button onclick="carregarLogs()" class="btn-close" style="padding: 6px 12px; font-size:12px; height:auto;">üîÑ Atualizar</button>
                        </div>
                    </div>
                    <table class="table-logs" style="width:100%; font-size:13px; border-collapse: collapse;">
                        <thead>
                            <tr style="background:#f8fafc; text-align:left;">
                                <th style="padding:12px 10px; color:#64748b; font-weight:600;">Data/Hora</th>
                                <th style="padding:12px 10px; color:#64748b; font-weight:600;">Usu√°rio</th>
                                <th style="padding:12px 10px; color:#64748b; font-weight:600;">A√ß√£o / Detalhes</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-logs"></tbody>
                    </table>
                </div>

                <div id="tab-backup" class="tab-pane">
                    <h4 style="color: #334155; margin-bottom: 20px;">Gerenciamento do Banco de Dados</h4>
                    
                    <div style="margin-bottom: 20px; padding: 20px; background: #f0f9ff; border-radius: 8px; border: 1px solid #bae6fd;">
                        <h5 style="margin-bottom: 5px; color: #0284c7; font-size: 15px;">‚¨áÔ∏è Exportar Atendimentos (Offline)</h5>
                        <p style="font-size: 13px; margin-bottom: 15px; color: #475569;">Baixe uma c√≥pia de seguran√ßa leg√≠vel de todos os atendimentos j√° registrados.</p>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="baixarTodosExcel()" class="btn-novo" style="background-color: #10b981; padding: 10px 20px; width:auto;">üì• Excel Completo</button>
                            <button onclick="baixarTodosPDF()" class="btn-novo" style="background-color: #ef4444; padding: 10px 20px; width:auto;">üìÑ PDF Completo</button>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px; padding: 20px; background: #fffbeb; border-radius: 8px; border: 1px solid #fef3c7;">
                        <h5 style="margin-bottom: 5px; color: #d97706; font-size: 15px;">üíæ Backup do Sistema (JSON)</h5>
                        <p style="font-size: 13px; margin-bottom: 15px; color: #475569;">Fa√ßa o download do banco de dados completo para restaura√ß√£o futura.</p>
                        <button onclick="gerarBackup()" class="btn-novo" style="background-color: #f59e0b; padding: 10px 20px; width:auto;">‚¨áÔ∏è Gerar Backup</button>
                    </div>

                    <div style="padding: 20px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca;">
                        <h5 style="margin-bottom: 5px; color: #dc2626; font-size: 15px;">‚ö†Ô∏è Restaura√ß√£o do Banco de Dados</h5>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="file" id="file-restore" accept=".json" style="flex: 1; max-width:400px; padding: 8px; background: white; border: 1px solid #fca5a5;">
                            <button onclick="restaurarBackup()" class="btn-novo" style="background-color: #dc2626; padding: 10px 20px; width:auto;">‚¨ÜÔ∏è Restaurar</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="modal-transferir" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center; border-radius: 12px; padding: 30px;">
            <h3 style="color: #1e293b; margin-bottom: 15px;">Transferir Atendimento</h3>
            <p style="font-size: 13px; color: #64748b; margin-bottom: 15px;">Selecione o novo cemit√©rio destino:</p>
            <select id="novo_cemiterio_transferencia" style="margin-bottom: 20px;">
                <option value="CEMIT√âRIO DO MARU√ç">CEMIT√âRIO DO MARU√ç</option>
                <option value="CEMIT√âRIO DE S√ÉO FRANCISCO">CEMIT√âRIO DE S√ÉO FRANCISCO</option>
                <option value="CEMIT√âRIO DE ITAIPU">CEMIT√âRIO DE ITAIPU</option>
            </select>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button onclick="fecharModalTransferir()" class="btn-close" style="padding: 10px 20px; font-weight: 600;">Cancelar</button>
                <button onclick="confirmarTransferencia()" class="btn-novo" style="background-color: #0ea5e9; padding: 10px 20px;">Transferir</button>
            </div>
            <button onclick="fecharModalTransferir()" class="close" style="position: absolute; top: 15px; right: 20px;">√ó</button>
        </div>
    </div>

    <div id="modal-whatsapp" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center; border-radius: 12px; padding: 30px;">
            <h3 style="color: #1e293b; margin-bottom: 15px;">Enviar WhatsApp</h3>
            <p style="font-size: 13px; color: #64748b; margin-bottom: 15px;">Selecione o tipo de mensagem que deseja enviar ao contribuinte:</p>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button onclick="enviarWppTemplate('info')" class="btn-novo" style="background-color: #0ea5e9; width: 100%;">üìã Inf. √öteis do Atendimento</button>
                <button onclick="enviarWppTemplate('convite')" class="btn-novo" style="background-color: #8b5cf6; width: 100%;">üïäÔ∏è Informa√ß√µes para Familiares</button>
                <button onclick="enviarWppTemplate('gps')" class="btn-novo" style="background-color: #22c55e; width: 100%;">üìç Localiza√ß√£o da Sepultura</button>
            </div>
            <button onclick="fecharModalWpp()" class="btn-close" style="margin-top: 15px; width: 100%;">Cancelar</button>
            <button onclick="fecharModalWpp()" class="close" style="position: absolute; top: 15px; right: 20px;">√ó</button>
        </div>
    </div>

    <div id="modal-assinatura" class="modal">
        <div class="modal-content" style="max-width: 500px; text-align: center; border-radius: 12px; padding: 30px;">
            <h3 id="titulo-assinatura" style="color: #1e293b; margin-bottom: 5px;">Assinatura</h3>
            <div style="display: inline-block; width: 100%;">
                <canvas id="signature-pad" width="400" height="200" style="width: 100%; border-radius: 8px; background-color: #f8fafc; border: 2px dashed #cbd5e1;"></canvas>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                <button onclick="limparAssinatura()" class="btn-close" style="padding: 10px 20px; font-weight: 600;">Limpar</button>
                <button onclick="salvarAssinatura()" class="btn-novo" style="background-color: #3b82f6; padding: 10px 20px;">Confirmar</button>
            </div>
            <button onclick="fecharModalAssinatura()" class="close" style="position: absolute; top: 15px; right: 20px;">√ó</button>
        </div>
    </div>

    <footer style="text-align: center; padding: 20px; color: #94a3b8; font-size: 12px; margin-top: 30px; border-top: 1px solid #e2e8f0; font-family: 'Poppins', sans-serif;">
        ¬© 2026 Controle Funer√°rio Niter√≥i. Todos os direitos reservados.
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="script.js"></script>
</body>
</html>