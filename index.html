<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Funer√°rio - Niter√≥i</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="header-prefeitura">
        <div class="logo-area">
            <img src="https://niteroi.rj.gov.br/wp-content/uploads/2025/06/pmnlogo-2.png" alt="Prefeitura de Niter√≥i" id="logo-principal">
            <div class="titulo-area">
                <h3 style="margin-left: 10px; border-left: 2px solid #999; padding-left: 15px;">Servi√ßos Funer√°rios</h3>
            </div>
        </div>
        
        <div class="info-area">
            <button onclick="alternarDesign()" class="btn-tema" title="Mudar Visual">üé® Alternar Tema</button>

            <div class="controles-topo">
                <div class="input-topo-group">
                    <label>Local</label>
                    <select id="filtro-local">
                        <option value="CEMIT√âRIO DO MARU√ç">MARU√ç</option>
                        <option value="CEMIT√âRIO DE S√ÉO FRANCISCO">S√ÉO FRANCISCO</option>
                        <option value="CEMIT√âRIO DE ITAIPU">ITAIPU</option>
                    </select>
                </div>
                <div class="divisor-vertical"></div>
                <div class="input-topo-group">
                    <label>Data</label>
                    <input type="date" id="filtro-data">
                </div>
            </div>
            <span class="badge-covid">COVID-19</span>
        </div>
    </header>

    <div class="main-content">
        <div class="controles">
            <button onclick="abrirModalEstatisticas()" class="btn-imprimir" style="border-color: #8e44ad; color: #8e44ad;">üìä Estat√≠sticas</button>
            <button onclick="imprimirRelatorio('portrait')" class="btn-imprimir">üñ®Ô∏è Retrato</button>
            <button onclick="imprimirRelatorio('landscape')" class="btn-imprimir">üñ®Ô∏è Paisagem</button>
            <button onclick="abrirModal()" class="btn-novo">+ Novo Atendimento</button>
        </div>

        <div class="tabela-container">
            <table>
                <thead>
                    <tr>
                        <th style="min-width: 220px;">Respons√°vel / Urna</th>
                        <th>Hora</th>
                        <th style="min-width: 220px;">Nome / Causa</th>
                        <th>Gav</th>
                        <th>Car</th>
                        <th>N¬∫ Sepul</th>
                        <th>QD</th>
                        <th>Hospital</th>
                        <th>Cap</th>
                        <th style="min-width: 130px;">Falecimento / Tempo</th>
                        <th style="text-align: right; min-width: 90px;">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tabela-corpo">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Registro de Atendimento</h3>
                <span class="close" onclick="fecharModal()">√ó</span>
            </div>
            
            <form id="form-atendimento">
                <input type="hidden" id="docId"> 
                
                <div class="form-grid">
                    <div class="input-group span-1">
                        <label>Hora Sepultamento</label>
                        <select id="hora" required></select>
                    </div>
                    <div class="input-group span-1">
                        <label>Telefone Respons√°vel</label>
                        <input type="text" id="telefone" placeholder="(21) 99999-9999">
                    </div>
                    <div class="input-group span-2">
                        <label>Nome do Respons√°vel</label>
                        <input type="text" id="resp_nome" placeholder="Nome do familiar ou empresa" required>
                    </div>
                    
                    <div class="input-group span-1">
                        <label>Grau Parentesco</label>
                        <input type="text" id="parentesco" list="lista-parentesco" placeholder="Selecione...">
                        <datalist id="lista-parentesco">
                            <option value="C√îNJUGE"><option value="FILHO(A)"><option value="PAI/M√ÉE"><option value="IRM√ÉO(√É)">
                            <option value="NETO(A)"><option value="SOBRINHO(A)"><option value="GENRO/NORA"><option value="CUNHADO(A)">
                            <option value="TIO(A)"><option value="PRIMO(A)"><option value="OUTRO">
                        </datalist>
                    </div>
                    <div class="input-group span-2">
                        <label>Funer√°ria</label>
                        <input type="text" id="funeraria" list="lista-funerarias" placeholder="Selecione..." required>
                        <datalist id="lista-funerarias">
                            <option value="RIO PAX NITER√ìI"><option value="FUNER√ÅRIA SANTA ROSA"><option value="FUNER√ÅRIA NITER√ìI">
                            <option value="FUNER√ÅRIA S√ÉO FRANCISCO"><option value="FUNER√ÅRIA MENINO DEUS"><option value="SAF (ASSIST√äNCIA FAMILIAR)">
                            <option value="PLASIR"><option value="SOCIAL"><option value="DOM BOSCO"><option value="MAVERICK"><option value="PR√ìPRIA FAM√çLIA">
                        </datalist>
                    </div>
                    <div class="input-group span-1">
                        <label>Isen√ß√£o?</label>
                        <select id="isencao" required>
                            <option value="NAO">N√ÉO (PAGO)</option>
                            <option value="SIM">SIM (100% GRATUIDADE)</option>
                            <option value="50">SIM (50% DESCONTO)</option>
                        </select>
                    </div>
                    <div class="input-group span-1">
                        <label>Requisito Isen√ß√£o</label>
                        <input type="text" id="requisito" list="lista-requisitos" placeholder="Motivo...">
                        <datalist id="lista-requisitos">
                            <option value="CADUNICO"><option value="MOEDA ARARIBOIA"><option value="FUNCION√ÅRIO PMN"><option value="OUTRO (DIGITE)">
                        </datalist>
                    </div>
                    
                    <div class="input-group span-1">
                        <label>Classifica√ß√£o</label>
                        <select id="classificacao_obito">
                            <option value="ADULTO">ADULTO</option>
                            <option value="ANJO">ANJO (Crian√ßa/Natimorto)</option>
                        </select>
                    </div>

                    <div class="input-group span-1">
                        <label>Tamanho Urna</label>
                        <select id="combo_urna">
                            <option value="">Selecione...</option>
                            <option value="NORMAL">Normal</option>
                            <option value="G">G</option>
                            <option value="GG">GG</option>
                            <option value="3G">3G</option>
                        </select>
                    </div>
                    
                    <div class="input-group span-2">
                        <label>Tipo da Urna (Material/Modelo)</label>
                        <input type="text" id="tipo_urna_detalhe" list="lista-tipos-urna" placeholder="Ex: Madeira, Sextavada...">
                        <datalist id="lista-tipos-urna">
                            <option value="MADEIRA PADR√ÉO"><option value="SEXTAVADA"><option value="ZINCO"><option value="BIO (ECOL√ìGICA)"><option value="LUXO"><option value="IML / RABEC√ÉO">
                        </datalist>
                    </div>

                    <div class="input-group span-4">
                        <label>Servi√ßos Adicionais / Opcionais</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" id="chk_tanato"> Tanatopraxia</label>
                            <label><input type="checkbox" id="chk_invol"> Invol</label>
                            <label><input type="checkbox" id="chk_translado"> Translado</label>
                            <label><input type="checkbox" id="chk_urna_opc"> Urna</label>
                        </div>
                    </div>

                    <div class="input-group span-4">
                        <label>Nome do Falecido</label>
                        <input type="text" id="nome" required style="font-weight: 600;">
                    </div>
                    
                    <div class="input-group span-4">
                        <label>Causa da Morte (Selecione para adicionar)</label>
                        <div style="display: flex; gap: 10px;">
                            <select id="seletor_causas" style="width: 40%; border: 1px solid #3699ff;">
                                <option value="">+ Adicionar Causa...</option>
                                <optgroup label="Doen√ßas Infecciosas / Risco">
                                    <option value="COVID-19">COVID-19</option>
                                    <option value="TUBERCULOSE">TUBERCULOSE</option>
                                    <option value="MENINGITE">MENINGITE</option>
                                    <option value="HEPATITE B">HEPATITE B</option>
                                    <option value="HEPATITE C">HEPATITE C</option>
                                    <option value="HIV/AIDS">HIV/AIDS</option>
                                    <option value="H1N1 (INFLUENZA)">H1N1 (INFLUENZA)</option>
                                    <option value="LEPTOSPIROSE">LEPTOSPIROSE</option>
                                    <option value="SARAMPO">SARAMPO</option>
                                    <option value="FEBRE AMARELA">FEBRE AMARELA</option>
                                    <option value="SEPSE / SEPTICEMIA">SEPSE / SEPTICEMIA</option>
                                </optgroup>
                                <optgroup label="Causas Comuns">
                                    <option value="CHOQUE S√âPTICO">CHOQUE S√âPTICO</option>
                                    <option value="INSUFICI√äNCIA RESPIRAT√ìRIA">INSUFICI√äNCIA RESPIRAT√ìRIA</option>
                                    <option value="INSUFICI√äNCIA RENAL AGUDA">INSUFICI√äNCIA RENAL AGUDA</option>
                                    <option value="NEOPLASIA MALIGNA">NEOPLASIA MALIGNA</option>
                                    <option value="INFARTO AGUDO DO MIOC√ÅRDIO">INFARTO (IAM)</option>
                                    <option value="AVC">AVC (ACIDENTE VASCULAR)</option>
                                    <option value="PNEUMONIA">PNEUMONIA</option>
                                    <option value="FAL√äNCIA M√öLTIPLA DE √ìRG√ÉOS">FAL√äNCIA M√öLTIPLA</option>
                                    <option value="SENILIDADE">SENILIDADE</option>
                                    <option value="HIPERTENS√ÉO ARTERIAL">HIPERTENS√ÉO ARTERIAL</option>
                                    <option value="DIABETES MELLITUS">DIABETES MELLITUS</option>
                                    <option value="PARADA CARDIORRESPIRAT√ìRIA">PARADA CARDIORRESPIRAT√ìRIA</option>
                                    <option value="CIRROSE HEP√ÅTICA">CIRROSE HEP√ÅTICA</option>
                                    <option value="DOEN√áA DE ALZHEIMER">DOEN√áA DE ALZHEIMER</option>
                                </optgroup>
                                <optgroup label="Causas Externas">
                                    <option value="TRAUMATISMO CRANIANO">TRAUMATISMO CRANIANO</option>
                                    <option value="AFOGAMENTO">AFOGAMENTO</option>
                                    <option value="ACIDENTE DE TR√ÇNSITO">ACIDENTE DE TR√ÇNSITO</option>
                                    <option value="HOMIC√çDIO (PAF)">HOMIC√çDIO (PAF)</option>
                                    <option value="SUIC√çDIO">SUIC√çDIO</option>
                                    <option value="CAUSA INDETERMINADA">CAUSA INDETERMINADA</option>
                                </optgroup>
                            </select>
                            <input type="text" id="causa" placeholder="Causas aparecer√£o aqui..." required style="width: 60%;">
                        </div>
                    </div>

                    <div class="input-group span-1">
                        <label>Tipo Sepultura</label>
                        <select id="tipo_sepultura" required>
                            <option value="">Selecione...</option>
                            <option value="GAVETA">Gaveta</option>
                            <option value="CARNEIRO">Carneiro</option>
                            <option value="PERPETUA">Perp√©tua</option>
                            <option value="COVA RASA">Cova Rasa</option>
                        </select>
                    </div>
                    <div class="input-group span-1">
                        <label>N¬∫ Sepul</label>
                        <input type="text" id="sepul" required>
                    </div>
                    <div class="input-group span-1">
                        <label>QD</label>
                        <input type="text" id="qd" required>
                    </div>
                    
                    <div class="input-group span-1">
                        <label>Geolocaliza√ß√£o (Lat, Long)</label>
                        <input type="text" id="geo_coords" placeholder="-22.88..., -43.12..." title="Copie do Google Maps">
                    </div>
                    
                    <div class="input-group span-4 hidden" id="div-motivo-sepultura">
                        <label style="color:red;">Motivo Troca</label>
                        <input type="text" id="motivo_troca_sepultura" placeholder="Explique a mudan√ßa...">
                    </div>

                    <div class="input-group span-2">
                        <label>Hospital / Local</label>
                        <input type="text" id="hospital" list="lista-hospitais" placeholder="Selecione..." required>
                        <datalist id="lista-hospitais">
                            <option value="DOMIC√çLIO">
                            <option value="OUTRO HOSPITAL (DIGITE O NOME)">
                            <option value="HMCT (CARLOS TORTELLY)">
                            <option value="HEAL (AZEVEDO LIMA)">
                            <option value="HUAP (ANT√îNIO PEDRO)">
                            <option value="HOSP. OR√äNCIO DE FREITAS">
                            <option value="HOSP. PSIQUI√ÅTRICO JURUJUBA">
                            <option value="HOSP. OCE√ÇNICO">
                            <option value="HOSP. GETULINHO">
                            <option value="UPA M√ÅRIO MONTEIRO">
                            <option value="UPA FONSECA">
                            <option value="CHN (COMPLEXO HOSPITALAR)">
                            <option value="HCN (CL√çNICAS DE NITER√ìI)">
                            <option value="HOSP. SANTA MARTHA">
                            <option value="HOSP. S√ÉO LUCAS">
                            <option value="HOSP. ICARA√ç">
                            <option value="HEAT (ALBERTO TORRES)">
                            <option value="HOSP. LUIZ PALMIER">
                            <option value="PRONTO SOCORRO CENTRAL (SG)">
                            <option value="HOSP. S√ÉO GON√áALO">
                            <option value="HOSP. FRANCISCANO (NS. GRA√áAS)">
                            <option value="IML - NITER√ìI">
                            <option value="IML - S√ÉO GON√áALO">
                        </datalist>
                    </div>

                    <div class="input-group span-2 hidden" id="div-local-domicilio" style="flex-direction: row; gap: 5px;">
                        <div style="flex: 1;">
                            <label>UF</label>
                            <select id="estado_obito">
                                <option value="">UF</option><option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option><option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option><option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option><option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option><option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option><option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option><option value="RJ">RJ</option><option value="RN">RN</option><option value="RS">RS</option><option value="RO">RO</option><option value="RR">RR</option><option value="SC">SC</option><option value="SP">SP</option><option value="SE">SE</option><option value="TO">TO</option>
                            </select>
                        </div>
                        <div style="flex: 2;">
                            <label>Cidade</label>
                            <select id="cidade_obito" disabled><option value="">Selecione a UF</option></select>
                        </div>
                    </div>

                    <div class="input-group span-2">
                        <label>Capela</label>
                        <input type="text" id="cap" list="lista-capelas" placeholder="Selecione..." required>
                        <datalist id="lista-capelas">
                            <option value="SEM VEL√ìRIO / DIRETO"><option value="CAPELA A"><option value="CAPELA B"><option value="CAPELA C">
                            <option value="CAPELA D"><option value="CAPELA E"><option value="CAPELA F"><option value="CAPELA G"><option value="CAPELA H">
                        </datalist>
                    </div>

                    <div class="input-group span-2">
                        <label>Data Falecimento</label>
                        <input type="date" id="data_obito" required>
                    </div>
                    <div class="input-group span-2">
                        <label>Hora Falecimento</label>
                        <input type="time" id="hora_obito" required>
                    </div>

                    <div class="input-group span-1">
                        <label>Sepult. < 24h?</label>
                        <select id="do_24h">
                            <option value="NAO">N√ÉO</option>
                            <option value="SIM">SIM (Liberado)</option>
                        </select>
                    </div>

                    <div class="input-group span-3">
                        <label>Observa√ß√µes</label>
                        <textarea id="urna_info" rows="2" placeholder="Observa√ß√µes gerais..." required></textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-cancelar" onclick="fecharModal()">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar Dados</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-visualizar" class="modal">
        <div class="modal-content" style="max-width: 700px; background: #fff;">
            <div class="modal-header">
                <h3>Ficha de Atendimento</h3>
                <span class="close" onclick="fecharModalVisualizar()">√ó</span>
            </div>
            
            <div class="ficha-visualizacao">
                <div class="ficha-header">
                    <h2>Prefeitura Municipal de Niter√≥i</h2>
                    <p>Coordenadoria Municipal de Servi√ßos Funer√°rios</p>
                </div>

                <div class="ficha-linha"><span class="ficha-label">Hor√°rio:</span><span class="ficha-valor" id="view_hora"></span></div>
                <div class="ficha-linha"><span class="ficha-label">Falecido(a):</span><span class="ficha-valor" id="view_nome"></span></div>
                <div class="ficha-linha"><span class="ficha-label">Causa da Morte:</span><span class="ficha-valor" id="view_causa"></span></div>
                <div class="ficha-linha">
                    <span class="ficha-label">Data/Hora √ìbito:</span>
                    <span class="ficha-valor">
                        <span id="view_data_obito"></span> √†s <span id="view_hora_obito"></span>
                        <span id="view_do_24h" style="margin-left:10px; color:var(--danger); font-weight:900;"></span>
                    </span>
                </div>
                <div class="ficha-linha"><span class="ficha-label">Respons√°vel:</span><span class="ficha-valor" id="view_resp_completo"></span></div>
                
                <div class="ficha-linha"><span class="ficha-label">Telefone:</span><span class="ficha-valor" id="view_telefone"></span></div>
                
                <div class="ficha-linha"><span class="ficha-label">Funer√°ria:</span><span class="ficha-valor" id="view_funeraria"></span></div>
                <div class="ficha-linha"><span class="ficha-label">Acolhimento:</span><span class="ficha-valor" id="view_isencao_completa"></span></div>
                <div class="ficha-linha"><span class="ficha-label">Dados da Urna:</span><span class="ficha-valor"><span id="view_combo_urna"></span> - <span id="view_tipo_urna_detalhe"></span></span></div>
                <div class="ficha-linha"><span class="ficha-label">Servi√ßos Extras:</span><span class="ficha-valor" id="view_servicos_adicionais"></span></div>
                <div class="ficha-linha">
                    <span class="ficha-label">Local Sepul.:</span>
                    <span class="ficha-valor">
                        Tipo: <span id="view_tipo_sepultura"></span> | N¬∫: <span id="view_sepul"></span> | QD: <span id="view_qd"></span>
                    </span>
                </div>
                <div class="ficha-linha"><span class="ficha-label">Local √ìbito:</span><span class="ficha-valor" id="view_hospital_completo"></span></div>
                <div class="ficha-linha"><span class="ficha-label">Vel√≥rio:</span><span class="ficha-valor" id="view_cap"></span></div>
                <div class="ficha-linha" style="border-bottom: none;"><span class="ficha-label">Observa√ß√µes:</span><span class="ficha-valor" id="view_urna_info" style="display: block; margin-top: 5px;"></span></div>
                
                <div id="view_map_container" style="display:none; margin-top: 20px;">
                    <div class="ficha-linha" style="border-bottom:none; margin-bottom:5px;">
                        <span class="ficha-label">Localiza√ß√£o:</span>
                    </div>
                    <div id="mapa-frame" style="width:100%; height:250px; border:1px solid #ccc; border-radius:6px; overflow:hidden;"></div>
                    <div style="text-align:right; margin-top:5px;">
                        <a id="link-gps" href="#" target="_blank" style="font-size:12px; font-weight:bold; color:var(--primary-color); text-decoration:none;">üìç Abrir no Google Maps</a>
                    </div>
                </div>

            </div>

            <div class="modal-footer" style="justify-content: space-between;">
                <div style="display:flex; gap:10px;">
                    <button type="button" class="btn-imprimir" id="btn-gerar-comprovante" onclick="gerarComprovante()">üìÑ Comprovante</button>
                    <button type="button" class="btn-novo" style="background-color: #e67e22;" onclick="gerarEtiqueta()">üè∑Ô∏è Etiqueta</button>
                    <button type="button" class="btn-novo btn-whatsapp" onclick="enviarWhatsapp()">üì± WhatsApp</button>
                    <button type="button" class="btn-novo btn-sms" onclick="enviarSMS()">üí¨ SMS</button>
                </div>
                <button type="button" class="btn-cancelar" onclick="fecharModalVisualizar()">Fechar</button>
            </div>
        </div>
    </div>

    <div id="modal-estatisticas" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Relat√≥rio de Causas de Morte</h3>
                <span class="close" onclick="fecharModalEstatisticas()">√ó</span>
            </div>
            
            <div style="padding: 20px;">
                <div class="controles-topo" style="margin-bottom: 20px; justify-content: center; gap: 10px; flex-wrap: wrap;">
                    <button onclick="carregarEstatisticas(7)" class="btn-imprimir">7 Dias</button>
                    <button onclick="carregarEstatisticas(14)" class="btn-imprimir">14 Dias</button>
                    <button onclick="carregarEstatisticas(30)" class="btn-imprimir">30 Dias</button>
                    <div style="width: 1px; height: 25px; background: #ccc; margin: 0 10px;"></div>
                    <button onclick="baixarExcel()" class="btn-novo" style="background-color: #27ae60;">üì• Excel</button>
                    <button onclick="baixarPDF()" class="btn-novo" style="background-color: #c0392b;">üì• PDF</button>
                </div>

                <div id="loading-stats" style="text-align:center; display:none; color:#666;">
                    Carregando dados em tempo real...
                </div>

                <div class="grafico-container">
                    <canvas id="grafico-causas"></canvas>
                </div>

                <div id="lista-estatisticas" style="max-height: 300px; overflow-y: auto; margin-top: 20px;"></div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-cancelar" onclick="fecharModalEstatisticas()">Fechar</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script src="script.js"></script>
</body>
</html>